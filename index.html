<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AR Human Talk with Mouth Animation</big>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <!-- AR.js -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin:0; overflow:hidden;">

  <!-- Play / Stop товч -->
  <button id="playBtn"
    style="position:absolute; top:20px; left:20px; z-index:999; padding:10px 20px;">
    ▶ Start
  </button>

  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false;"
    vr-mode-ui="enabled:false">

    <!-- 3D Хүн -->
    <a-entity id="human"
              gltf-model="human.glb"
              position="0 0.8 -1.5"
              rotation="0 -90 0"
              scale="1.5 1.5 1.5"
              look-at="[camera]">

      <!-- Дуу -->
      <a-sound id="voice"
               src="voice.mp3"
               autoplay="false"
               loop="false">
      </a-sound>

      <!-- Амны animation -->
      <a-animation id="mouthAnim"
                   attribute="scale"
                   from="1.5 1.5 1.5"
                   to="1.5 1.6 1.5"
                   direction="alternate"
                   dur="200"
                   repeat="indefinite"
                   easing="ease-in-out"
                   begin="playMouth"
                   end="stopMouth">
      </a-animation>

    </a-entity>

    <a-camera position="0 1.6 0"></a-camera>
  </a-scene>

  <script>
    const playBtn = document.getElementById("playBtn");
    const voiceEl = document.getElementById("voice");
    const human = document.getElementById("human");

    let isPlaying = false;

    playBtn.addEventListener("click", () => {
      const sound = voiceEl.components.sound;

      if (!isPlaying) {
        sound.playSound();
        human.emit("playMouth");
        playBtn.textContent = "⏸ Stop";
        isPlaying = true;

        // Дуу дуусахад автоматаар зогсооно
        sound.sound.onended = () => {
          human.emit("stopMouth");
          playBtn.textContent = "▶ Start";
          isPlaying = false;
        };

      } else {
        sound.stopSound();
        human.emit("stopMouth");
        playBtn.textContent = "▶ Start";
        isPlaying = false;
      }
    });
  </script>

</body>
</html>
